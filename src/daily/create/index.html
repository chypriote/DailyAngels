<template>
	<require from="./components/yesterday"></require>
	<require from="./components/today"></require>
	<require from="./components/problems"></require>
	<require from="./metrics"></require>
	<require from="../../generic/date-format.filter"></require>
	<require from="../../generic/capitalize.filter"></require>

	<div class="sa-layout-dashboard-page_title">
		<h1 class="sa-text --mega --bold">Ajouter un daily</h1>
	</div>
	<div class="sa-layout-dashboard-page_content">

    <div class="sa-grid_col" if.bind="!sprints.length && loaded">
      <div class="sa-flash-message --error">
        Vous devez <a route-href="route: sprintCreate;">cr√©er un sprint</a> avant d'ajouter un daily.
      </div>
    </div>

		<div class="sa-grid" if.bind="sprints.length && loaded">

			<div class="sa-grid_col" show.bind="errors">
				<div class="sa-flash-message --error">
					Les champs <span repeat.for="error of errors">${error.rule.property.displayName} </span> sont obligatoires.
				</div>
			</div>

			<div class="sa-grid_col --one-third@on-desktop">
				<div class="sa-panel">
					<div class="sa-category-title">
						<p class="sa-text --bold --mega --emphasis-darker">Sprint Progress</p>
					</div>
					
					<div class="sa-form_row">
						<div class="sa-grid">
							<div class="sa-grid_col --half@on-desktop">
								<fieldset>
									<label for="sprint_id" class="sa-text --secondary">Current Sprint</label>
									<select value.bind="daily.sprint & validate" name="sprint_id" class="sa-form_select --full">
										<option repeat.for="sprint of sprints" model.bind="sprint">Sprint #${sprint.id}</option>
									</select>
								</fieldset>
							</div>
							<div class="sa-grid_col --half@on-desktop">
								<fieldset>
									<label for="current_day" class="sa-text --secondary">Day</label>
									<select value.bind="daily.date & validate" name="current_day" class="sa-form_select --full">
										<option repeat.for="day of daily.sprint.days" model.bind="day">${day | dateFormat:'ddd D MMMM' |capitalize}</option>
									</select>
								</fieldset>
							</div>
						</div>
					</div>

					<div class="sa-form_row">
						<hr class="sa-line --dashboard">
					</div>

					<div class="sa-form_row">
						<metrics metrics.bind="daily.metrics & validate"></metrics>
					</div>
				</div>

				<div class="sa-form_row">
					<button class="sa-call-to-action --full" click.delegate="saveDaily()">
						<i class="material-icons sa-icon --material">save</i> Enregistrer
					</button>
				</div>
			</div>

			<div class="sa-grid_col --two-thirds@on-desktop">
				<div class="sa-grid">
					<div class="sa-grid_col">
						<yesterday items.bind="daily.yesterday & validate"></yesterday>
					</div>
					<div class="sa-grid_col">
						<today items.bind="daily.today & validate"></today>
					</div>
					<div class="sa-grid_col">
						<problems items.bind="daily.problems & validate"></problems>
					</div>
				</div>
			</div>
		</div>
	</div>
</template>
